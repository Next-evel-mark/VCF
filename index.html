<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple VCF Maker</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 18px; max-width: 820px; margin: auto; }
    input, textarea, select { width: 100%; padding: 8px; margin: 6px 0 12px; box-sizing: border-box; }
    .row { display:flex; gap:8px; }
    .row > * { flex:1; }
    .btn { padding:10px 14px; border:0; background:#2b6cb0; color:white; cursor:pointer; border-radius:6px; }
    .btn.secondary { background:#6b7280; }
    .contact { border:1px solid #ddd; padding:12px; margin-bottom:12px; border-radius:8px; background:#fafafa; }
    pre { white-space: pre-wrap; background:#111; color:#eee; padding:12px; border-radius:8px; max-height:240px; overflow:auto; }
  </style>
</head>
<body>
  <h1>Simple VCF Maker</h1>
  <p>Enter contact info, click <strong>Add contact</strong>. When ready click <strong>Generate VCF</strong> to download.</p>

  <div id="formArea" class="contact">
    <div class="row">
      <input id="firstName" placeholder="First name" />
      <input id="lastName" placeholder="Last name" />
    </div>

    <input id="fullName" placeholder="Display name (optional - e.g. John Doe)" />

    <div class="row">
      <input id="phone" placeholder="Phone (e.g. +254712345678)" />
      <input id="email" placeholder="Email (e.g. name@example.com)" />
    </div>

    <input id="org" placeholder="Organization (Company)" />
    <input id="title" placeholder="Job title" />
    <input id="street" placeholder="Street address" />
    <div class="row">
      <input id="city" placeholder="City" />
      <input id="region" placeholder="Region / State" />
    </div>
    <div class="row">
      <input id="postal" placeholder="Postal code" />
      <input id="country" placeholder="Country" />
    </div>

    <textarea id="note" rows="3" placeholder="Note (optional)"></textarea>

    <div style="display:flex; gap:8px;">
      <button id="addContact" class="btn">Add contact</button>
      <button id="clearForm" class="btn secondary">Clear form</button>
    </div>
  </div>

  <h3>Contacts to include</h3>
  <div id="contactsList" style="margin-bottom:12px;"></div>

  <div style="display:flex; gap:8px; margin-bottom:16px;">
    <button id="generate" class="btn">Generate VCF (download)</button>
    <button id="showText" class="btn secondary">Show VCF text</button>
  </div>

  <details>
    <summary>VCF text preview</summary>
    <pre id="vcfPreview">(click "Show VCF text")</pre>
  </details>

<script>
(function(){
  const contacts = [];

  function escapeV(str) {
    if(!str) return '';
    // escape commas, semicolons, newlines as required by vCard
    return String(str).replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/,/g,'\\,').replace(/;/g,'\\;');
  }

  function buildVCard(c){
    // Use vCard 3.0
    const first = c.first || '';
    const last = c.last || '';
    const fn = c.fullName || (first + (first && last ? ' ' : '') + last) || '';
    let v = '';
    v += 'BEGIN:VCARD\\r\\n';
    v += 'VERSION:3.0\\r\\n';
    v += 'N:' + escapeV(last) + ';' + escapeV(first) + ';;;\\r\\n';
    if(fn) v += 'FN:' + escapeV(fn) + '\\r\\n';
    if(c.org) v += 'ORG:' + escapeV(c.org) + '\\r\\n';
    if(c.title) v += 'TITLE:' + escapeV(c.title) + '\\r\\n';
    if(c.phone) v += 'TEL;TYPE=CELL:' + escapeV(c.phone) + '\\r\\n';
    if(c.email) v += 'EMAIL;TYPE=INTERNET:' + escapeV(c.email) + '\\r\\n';
    if(c.street || c.city || c.region || c.postal || c.country) {
      // ADR: PO Box;Extended;Street;City;Region;Postal;Country
      v += 'ADR;TYPE=HOME:;;' + escapeV(c.street || '') + ';' + escapeV(c.city || '') + ';' + escapeV(c.region || '') + ';' + escapeV(c.postal || '') + ';' + escapeV(c.country || '') + '\\r\\n';
    }
    if(c.note) v += 'NOTE:' + escapeV(c.note) + '\\r\\n';
    v += 'END:VCARD\\r\\n';
    return v;
  }

  function renderContacts(){
    const list = document.getElementById('contactsList');
    list.innerHTML = '';
    contacts.forEach((c, i) => {
      const el = document.createElement('div');
      el.className = 'contact';
      el.innerHTML = '<strong>' + (c.fullName || (c.first + ' ' + c.last) || '(no name)') + '</strong>'
        + '<div>' + (c.phone ? 'üìû ' + c.phone + ' ' : '') + (c.email ? '‚úâÔ∏è ' + c.email : '') + '</div>'
        + '<div style="margin-top:8px;"><button data-i="'+i+'" class="btn smallRemove" style="background:#e53e3e">Remove</button></div>';
      list.appendChild(el);
    });

    // attach remove handlers
    [...document.querySelectorAll('.smallRemove')].forEach(btn => {
      btn.addEventListener('click', e => {
        const i = Number(e.target.dataset.i);
        contacts.splice(i,1);
        renderContacts();
      });
    });
  }

  document.getElementById('addContact').addEventListener('click', () => {
    const c = {
      first: document.getElementById('firstName').value.trim(),
      last: document.getElementById('lastName').value.trim(),
      fullName: document.getElementById('fullName').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      email: document.getElementById('email').value.trim(),
      org: document.getElementById('org').value.trim(),
      title: document.getElementById('title').value.trim(),
      street: document.getElementById('street').value.trim(),
      city: document.getElementById('city').value.trim(),
      region: document.getElementById('region').value.trim(),
      postal: document.getElementById('postal').value.trim(),
      country: document.getElementById('country').value.trim(),
      note: document.getElementById('note').value.trim()
    };
    // simple validation: must have at least a name or phone or email
    if(!c.first && !c.last && !c.fullName && !c.phone && !c.email) {
      alert('Please enter at least a name, phone, or email.');
      return;
    }
    contacts.push(c);
    renderContacts();
    // clear some fields for convenience
    document.getElementById('firstName').value = '';
    document.getElementById('lastName').value = '';
    document.getElementById('fullName').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('email').value = '';
    document.getElementById('org').value = '';
    document.getElementById('title').value = '';
    document.getElementById('street').value = '';
    document.getElementById('city').value = '';
    document.getElementById('region').value = '';
    document.getElementById('postal').value = '';
    document.getElementById('country').value = '';
    document.getElementById('note').value = '';
  });

  document.getElementById('clearForm').addEventListener('click', () => {
    ['firstName','lastName','fullName','phone','email','org','title','street','city','region','postal','country','note'].forEach(id => document.getElementById(id).value = '');
  });

  document.getElementById('generate').addEventListener('click', () => {
    if(contacts.length === 0) {
      if(!confirm('No contacts added. Do you want to generate a single contact from the current form?')) return;
      // use current form as single contact
      const c = {
        first: document.getElementById('firstName').value.trim(),
        last: document.getElementById('lastName').value.trim(),
        fullName: document.getElementById('fullName').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim(),
        org: document.getElementById('org').value.trim(),
        title: document.getElementById('title').value.trim(),
        street: document.getElementById('street').value.trim(),
        city: document.getElementById('city').value.trim(),
        region: document.getElementById('region').value.trim(),
        postal: document.getElementById('postal').value.trim(),
        country: document.getElementById('country').value.trim(),
        note: document.getElementById('note').value.trim()
      };
      contacts.push(c);
      renderContacts();
    }

    // build vcf content
    const v = contacts.map(buildVCard).join('\\r\\n');
    const blob = new Blob([v], { type: 'text/vcard;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'contacts.vcf';
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      URL.revokeObjectURL(url);
      a.remove();
    }, 1000);
  });

  document.getElementById('showText').addEventListener('click', () => {
    if(contacts.length === 0) {
      document.getElementById('vcfPreview').textContent = '(no contacts yet)';
      return;
    }
    const text = contacts.map(buildVCard).join('\\n\\n');
    // convert \\r\\n escapes to real newlines for preview
    document.getElementById('vcfPreview').textContent = text.replace(/\\\\r\\\\n/g,'\\n');
  });

})();
</script>
</body>
</html>
